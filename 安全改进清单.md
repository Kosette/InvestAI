# InvestAI å®‰å…¨ä¸æ”¹è¿›æ¸…å•

> å¿«é€Ÿå‚è€ƒç‰ˆæœ¬ - è¯¦ç»†åˆ†æè¯·æŸ¥çœ‹ `SECURITY_ANALYSIS.md`

## ğŸ”´ é«˜ä¼˜å…ˆçº§ - å¿…é¡»ä¿®å¤

- [ ] **ç§»é™¤ SSL è¯ä¹¦éªŒè¯ç¦ç”¨** (`src/notifiers/senders/slack.py:7`)
  - å½“å‰: `ssl._create_default_https_context = ssl._create_unverified_context`
  - é£é™©: ä¸­é—´äººæ”»å‡»
  - ä¿®å¤: åˆ é™¤æ­¤è¡Œï¼Œæˆ–ä½¿ç”¨ certifi åŒ…æ›´æ–°è¯ä¹¦

- [ ] **ä¸º MCP æœåŠ¡æ·»åŠ è®¤è¯** (`src/mcp_server.py:106`)
  - å½“å‰: æ— ä»»ä½•è®¤è¯æœºåˆ¶
  - é£é™©: æœªæˆæƒè®¿é—®
  - ä¿®å¤: æ·»åŠ  API Token æˆ–é™åˆ¶ç›‘å¬åœ°å€ä¸º 127.0.0.1

- [ ] **Docker å®¹å™¨ä½¿ç”¨é root ç”¨æˆ·** (`docker/Dockerfile.mcp`)
  - å½“å‰: `USER root`
  - é£é™©: å®¹å™¨é€ƒé€¸åè·å¾— root æƒé™
  - ä¿®å¤: åˆ›å»ºå¹¶åˆ‡æ¢åˆ°é root ç”¨æˆ·

## ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ - å»ºè®®ä¿®å¤

- [ ] **æ·»åŠ è¾“å…¥éªŒè¯**
  - æ–‡ä»¶: `src/mcp_server.py`
  - é—®é¢˜: è‚¡ç¥¨ä»£ç ç­‰å‚æ•°ç¼ºå°‘æ ¼å¼éªŒè¯
  - ä¿®å¤: æ·»åŠ æ­£åˆ™è¡¨è¾¾å¼éªŒè¯

- [ ] **ç»†åŒ–å¼‚å¸¸å¤„ç†**
  - æ–‡ä»¶: `src/datacenter/market/stock.py` ç­‰å¤šå¤„
  - é—®é¢˜: `except Exception` è¿‡äºå®½æ³›
  - ä¿®å¤: æ•è·å…·ä½“å¼‚å¸¸ç±»å‹

- [ ] **æ—¥å¿—è„±æ•**
  - æ–‡ä»¶: `src/log.py`
  - é—®é¢˜: å¯èƒ½è®°å½•æ•æ„Ÿä¿¡æ¯
  - ä¿®å¤: æ·»åŠ æ•æ„Ÿä¿¡æ¯è¿‡æ»¤å™¨

- [ ] **Webhook æ·»åŠ é‡è¯•æœºåˆ¶**
  - æ–‡ä»¶: `src/notifiers/senders/webhook.py`
  - æ”¹è¿›: æ·»åŠ é‡è¯•é€»è¾‘ï¼Œæé«˜å¯é æ€§

## ğŸŸ¢ ä½ä¼˜å…ˆçº§ - ä¼˜åŒ–å»ºè®®

- [ ] **æ·»åŠ é€Ÿç‡é™åˆ¶**
  - é˜²æ­¢ API æ»¥ç”¨

- [ ] **é…ç½®æ–‡ä»¶å¤‡ä»½æœºåˆ¶**
  - è‡ªåŠ¨å¤‡ä»½ `conf/` ç›®å½•æ–‡ä»¶

- [ ] **æ·»åŠ å¥åº·æ£€æŸ¥ç«¯ç‚¹**
  - ç”¨äºå®¹å™¨ç¼–æ’å’Œç›‘æ§

- [ ] **æ”¹è¿›é”™è¯¯æ¶ˆæ¯**
  - åŒºåˆ†å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒ
  - é¿å…æ³„éœ²å†…éƒ¨å®ç°ç»†èŠ‚

- [ ] **æ·»åŠ  API æ—¥å¿—è®°å½•**
  - è®°å½•è¯·æ±‚/å“åº”æ—¶é—´
  - ä¾¿äºæ€§èƒ½åˆ†æå’Œè°ƒè¯•

## ğŸ› ï¸ å¼€å‘å·¥å…·å»ºè®®

```bash
# å®‰è£…å®‰å…¨æ£€æŸ¥å·¥å…·
pip install bandit safety semgrep

# è¿è¡Œå®‰å…¨æ‰«æ
bandit -r src/                    # Python å®‰å…¨æ‰«æ
safety check                       # ä¾èµ–æ¼æ´æ£€æŸ¥
semgrep --config=auto src/        # é™æ€ä»£ç åˆ†æ
```

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

- [ ] ç¡®ä¿ `.env` æ–‡ä»¶ä¸åœ¨ç‰ˆæœ¬æ§åˆ¶ä¸­
- [ ] æ‰€æœ‰æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡
- [ ] MCP æœåŠ¡æ·»åŠ è®¤è¯æˆ–ä»…ç›‘å¬æœ¬åœ°
- [ ] Docker å®¹å™¨ä½¿ç”¨é root ç”¨æˆ·
- [ ] SSL è¯ä¹¦éªŒè¯å·²å¯ç”¨
- [ ] æ—¥å¿—æ–‡ä»¶æƒé™è®¾ç½®æ­£ç¡® (600)
- [ ] å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶

## ğŸ¯ å¿«é€Ÿä¿®å¤ä»£ç ç‰‡æ®µ

### 1. ä¿®å¤ SSL éªŒè¯
```python
# src/notifiers/senders/slack.py
# åˆ é™¤ä»¥ä¸‹è¡Œ:
# import ssl
# ssl._create_default_https_context = ssl._create_unverified_context

# å¦‚éœ€å¤„ç†è¯ä¹¦é—®é¢˜:
import certifi
import ssl

# ä½¿ç”¨ certifi çš„è¯ä¹¦
ssl_context = ssl.create_default_context(cafile=certifi.where())
```

### 2. é™åˆ¶ MCP æœåŠ¡ç›‘å¬åœ°å€
```python
# src/mcp_server.py
if __name__ == "__main__":
    # ä»…æœ¬åœ°è®¿é—®
    mcp.run(transport="http", host="127.0.0.1", port=8888)
```

### 3. Docker é root ç”¨æˆ·
```dockerfile
# docker/Dockerfile.mcp
# åœ¨ CMD ä¹‹å‰æ·»åŠ :
RUN groupadd -r appuser && useradd -r -g appuser appuser
RUN chown -R appuser:appuser /app
USER appuser
```

### 4. æ·»åŠ è¾“å…¥éªŒè¯
```python
# src/mcp_server.py
import re

def validate_stock_code(code: str) -> bool:
    pattern = r'^[0-9]{6}$|^(sh|sz|bj)[0-9]{6}$'
    return bool(re.match(pattern, code.lower()))

@mcp.tool()
async def analyze_stock_tool(code: str):
    if not validate_stock_code(code):
        raise ValueError(f"Invalid stock code: {code}")
    # ... åŸæœ‰é€»è¾‘
```

## âœ… å·²åšå¾—å¥½çš„åœ°æ–¹

1. âœ… ç¯å¢ƒå˜é‡ç®¡ç† - ä½¿ç”¨ `.env` æ–‡ä»¶
2. âœ… ä¾èµ–é”å®š - `uv.lock` ç¡®ä¿å¯é‡ç°æ„å»º
3. âœ… ç±»å‹æç¤º - æé«˜ä»£ç è´¨é‡
4. âœ… Pydantic éªŒè¯ - é…ç½®éªŒè¯
5. âœ… Docker åŒ– - ä¾¿äºéƒ¨ç½²
6. âœ… è¯·æ±‚è¶…æ—¶ - é˜²æ­¢æŒ‚èµ·
7. âœ… ç»“æ„åŒ–æ—¥å¿— - ä½¿ç”¨ loguru

## ğŸ“Š å®‰å…¨è¯„åˆ†

**æ€»ä½“è¯„åˆ†**: 71/100 (ä¸­ç­‰åä¸Š)

- è®¤è¯ä¸æˆæƒ: 60/100
- æ•°æ®ä¿æŠ¤: 70/100
- è¾“å…¥éªŒè¯: 65/100
- é”™è¯¯å¤„ç†: 70/100
- æ—¥å¿—è®°å½•: 75/100
- ä¾èµ–ç®¡ç†: 85/100
- å®¹å™¨å®‰å…¨: 65/100
- ä»£ç è´¨é‡: 80/100

## ğŸ“š ç›¸å…³æ–‡æ¡£

- è¯¦ç»†åˆ†ææŠ¥å‘Š: `SECURITY_ANALYSIS.md`
- ç¯å¢ƒå˜é‡ç¤ºä¾‹: `.env.example`
- Docker é…ç½®: `docker/docker-compose.yml`

---

**æ³¨æ„**: æœ¬æ¸…å•ä»…ä¾›å‚è€ƒï¼Œå®é™…ä¿®å¤æ—¶è¯·æ ¹æ®å…·ä½“éœ€æ±‚è°ƒæ•´ã€‚
